{% extends "base.html" %}

{% block title %}Job Descriptions - AI Resume Filter{% endblock %}

{% block content %}
<h2 style="color: white; margin-bottom: 2rem;">üíº Job Descriptions</h2>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h3>All Job Postings</h3>
        <a href="{{ url_for('create_job') }}" class="btn btn-primary">‚ûï Create New Job</a>
    </div>
    
    {% if jobs %}
    <!-- Desktop/Tablet Table View -->
    <table class="desktop-table">
        <thead>
            <tr>
                <th>Job Title</th>
                <th>Candidates</th>
                <th>Avg Score</th>
                <th>Posted Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for job in jobs %}
            <tr>
                <td>
                    <strong>{{ job.title }}</strong><br>
                    <small style="color: #6c757d;">{{ job.description[:100] }}...</small>
                </td>
                <td>
                    <strong style="color: #667eea;">{{ job.candidate_count or 0 }}</strong> candidates
                </td>
                <td>
                    {% if job.avg_score %}
                        <strong style="color: #28a745;">{{ "%.1f"|format(job.avg_score) }}%</strong>
                    {% else %}
                        <span style="color: #6c757d;">N/A</span>
                    {% endif %}
                </td>
                <td>{{ job.created_at.strftime('%Y-%m-%d') }}</td>
                <td style="white-space: nowrap;">
                    <a href="{{ url_for('candidates', job_id=job.id) }}" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.85rem; margin-right: 0.5rem; min-width: 140px; text-align: center;">
                        View Candidates
                    </a>
                    <form method="POST" action="{{ url_for('delete_job', job_id=job.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this job? This will also delete all associated candidates and analysis results.');">
                        <button type="submit" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.85rem; background: #dc3545; border: none; border-radius: 8px; cursor: pointer; min-width: 90px; display: inline-block; line-height: 1.5; vertical-align: middle;">
                            üóëÔ∏è Delete
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- Mobile Card View -->
    <div class="mobile-cards">
        {% for job in jobs %}
        <div class="mobile-card">
            <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.5rem;">{{ job.title }}</div>
                <div style="color: #6c757d; font-size: 0.9rem; line-height: 1.4;">{{ job.description[:100] }}...</div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                    <div style="color: #6c757d; font-size: 0.85rem; margin-bottom: 0.25rem;">Candidates</div>
                    <div style="color: #667eea; font-weight: bold; font-size: 1.1rem;">{{ job.candidate_count or 0 }}</div>
                </div>
                <div>
                    <div style="color: #6c757d; font-size: 0.85rem; margin-bottom: 0.25rem;">Avg Score</div>
                    {% if job.avg_score %}
                        <div style="color: #28a745; font-weight: bold; font-size: 1.1rem;">{{ "%.1f"|format(job.avg_score) }}%</div>
                    {% else %}
                        <div style="color: #6c757d; font-size: 1.1rem;">N/A</div>
                    {% endif %}
                </div>
            </div>
            
            <div style="color: #6c757d; font-size: 0.85rem; margin-bottom: 1rem;">
                Posted: {{ job.created_at.strftime('%Y-%m-%d') }}
            </div>
            
            <div style="display: flex; gap: 0.5rem;">
                <a href="{{ url_for('candidates', job_id=job.id) }}" class="btn btn-primary" style="flex: 1; padding: 0.75rem; font-size: 0.9rem; text-align: center;">
                    View Candidates
                </a>
                <form method="POST" action="{{ url_for('delete_job', job_id=job.id) }}" style="flex: 0 0 auto;" onsubmit="return confirm('Are you sure you want to delete this job? This will also delete all associated candidates and analysis results.');">
                    <button type="submit" class="btn btn-secondary" style="padding: 0.75rem 1rem; font-size: 0.9rem; background: #dc3545;">
                        üóëÔ∏è
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="text-align: center; color: #6c757d; padding: 2rem;">
        No job postings yet. <a href="{{ url_for('upload') }}" style="color: #667eea; text-decoration: underline;">Create one</a> to get started.
    </p>
    {% endif %}
</div>
{% endblock %}
